<body>
  <div id="eventListener"></div>
</body>

<script>
  window.citFrames = {};

  let listener = document.querySelector("#eventListener")
  let iFrames = []

  function createNewFrame(resourceName, uiName, url) {
    const frame = document.createElement('iframe');
    frame.name = uiName;
    frame.allow = 'microphone *; camera *;';
    frame.src = url;
    frame.tabIndex = -1;

    document.body.appendChild(frame);

    frame.contentWindow.GetParentResourceName = function () {
      return resourceName;
    }

    return frame

  }

  window.addEventListener('message', (event) => {
    if (event.data.action == "loadNUI") {
      // Create the new iframe
      const uiName = event.data.name
      const url = event.data.url
      if (iFrames.find((e) => e.id == uiName))
        return console.log('ERROR, this uiName is already used:', uiName)

      let frame = createNewFrame(GetParentResourceName(), uiName, url);

      iFrames.push({
        uiName: uiName,
        element: frame
      })

    } else {
      // Redirect events
      const redirectedEvent = new event.constructor(event.type, event);
      if (event.data.messageTargetUiName) {
        const uiName = event.data.messageTargetUiName
        let frame = iFrames.find((frame) => frame.uiName == uiName)
        if (!frame)
          return console.log('ERROR, this uiName is not loaded', uiName)
        frame.element.contentWindow.dispatchEvent(redirectedEvent)
      } else {
        iFrames.forEach((frame) => {
          frame.element.contentWindow.dispatchEvent(redirectedEvent);
        })
      }
    }
  })



  const eventsToRedirect = [
    'keydown',
    'keyup',
    'wheel',
    'resize',
    'scroll',
    'click',
    'dblclick',
    'mousedown',
    'mouseenter',
    'mouseleave',
    'mousemove',
    'mouseout',
    'mouseover',
    'mouseup'
  ];
  eventsToRedirect.forEach((eventType) => {
    window.addEventListener(eventType, (event) => {
      const redirectedEvent = new event.constructor(event.type, event);
      iFrames.forEach((frame) => {
        let em;
        if (eventType.includes('key'))
          em = frame.element.contentWindow.document
        else
          em = frame.element.contentWindow.document.elementFromPoint(event.screenX, event.screenY)
        em.dispatchEvent(redirectedEvent)
      })
    })
  })

</script>

<style>
  body {
    background-color: transparent;
    margin: 0px;
    padding: 0px;
  }

  iframe {
    position: absolute;
    left: 0px;
    right: 0px;
    top: 0px;
    bottom: 0px;
    border: 0px;
    width: 100%;
    height: 100%;
  }

  #eventListener {
    z-index: 999999;
    position: absolute;
    left: 0px;
    right: 0px;
    top: 0px;
    bottom: 0px;
    border: 0px;
    width: 100%;
    height: 100%;
  }
</style>