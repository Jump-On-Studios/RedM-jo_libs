import{r as y,R as Ge,c as Q,j as N,a as We,F as Ve,u as Xe}from"./index-react-BgBOD2EG.js";import{L as se,R as $e,U as Ye,a as Ke,O as Ze,P as Je,S as Qe,b as ae,N as et,A as tt,W as nt,C as rt,B as ot,c as it,V as st,d as re,e as at,f as ct,T as lt,g as ut,h as ye,H as ft,D as dt,F as pt,i as vt,j as be}from"./index-threejs-CnVPMkYW.js";import{s as Ee,c as _e,_ as je}from"./index-DWFQb4A4.js";const we={},ht=e=>void Object.assign(we,e);function mt(e,n){function i(t,{args:r=[],attach:l,...c},f){let E=`${t[0].toUpperCase()}${t.slice(1)}`,h;if(t==="primitive"){if(c.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const o=c.object;h=$(o,{type:t,root:f,attach:l,primitive:!0})}else{const o=we[E];if(!o)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");h=$(new o(...r),{type:t,root:f,attach:l,memoizedProps:{args:r}})}return h.__r3f.attach===void 0&&(h.isBufferGeometry?h.__r3f.attach="geometry":h.isMaterial&&(h.__r3f.attach="material")),E!=="inject"&&ue(h,c),h}function s(t,r){let l=!1;if(r){var c,f;(c=r.__r3f)!=null&&c.attach?le(t,r,r.__r3f.attach):r.isObject3D&&t.isObject3D&&(t.add(r),l=!0),l||(f=t.__r3f)==null||f.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=t,ge(r),Y(r)}}function d(t,r,l){let c=!1;if(r){var f,E;if((f=r.__r3f)!=null&&f.attach)le(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){r.parent=t,r.dispatchEvent({type:"added"}),t.dispatchEvent({type:"childadded",child:r});const h=t.children.filter(a=>a!==r),o=h.indexOf(l);t.children=[...h.slice(0,o),r,...h.slice(o)],c=!0}c||(E=t.__r3f)==null||E.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=t,ge(r),Y(r)}}function p(t,r,l=!1){t&&[...t].forEach(c=>w(r,c,l))}function w(t,r,l){if(r){var c,f,E;if(r.__r3f&&(r.__r3f.parent=null),(c=t.__r3f)!=null&&c.objects&&(t.__r3f.objects=t.__r3f.objects.filter(C=>C!==r)),(f=r.__r3f)!=null&&f.attach)Re(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){var h;t.remove(r),(h=r.__r3f)!=null&&h.root&&Ct(oe(r),r)}const a=(E=r.__r3f)==null?void 0:E.primitive,g=!a&&(l===void 0?r.dispose!==null:l);if(!a){var o;p((o=r.__r3f)==null?void 0:o.objects,r,g),p(r.children,r,g)}if(delete r.__r3f,g&&r.dispose&&r.type!=="Scene"){const C=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Ee.unstable_scheduleCallback(Ee.unstable_IdlePriority,C):C()}Y(t)}}function u(t,r,l,c){var f;const E=(f=t.__r3f)==null?void 0:f.parent;if(!E)return;const h=i(r,l,t.__r3f.root);if(t.children){for(const o of t.children)o.__r3f&&s(h,o);t.children=t.children.filter(o=>!o.__r3f)}t.__r3f.objects.forEach(o=>s(h,o)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||w(E,t),h.parent&&(h.__r3f.autoRemovedBeforeAppend=!0),s(E,h),h.raycast&&h.__r3f.eventCount&&oe(h).getState().internal.interaction.push(h),[c,c.alternate].forEach(o=>{o!==null&&(o.stateNode=h,o.ref&&(typeof o.ref=="function"?o.ref(h):o.ref.current=h))})}const v=()=>{};return{reconciler:Ge({createInstance:i,removeChild:w,appendChild:s,appendInitialChild:s,insertBefore:d,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,r)=>{if(!r)return;const l=t.getState().scene;l.__r3f&&(l.__r3f.root=t,s(l,r))},removeChildFromContainer:(t,r)=>{r&&w(t.getState().scene,r)},insertInContainerBefore:(t,r,l)=>{if(!r||!l)return;const c=t.getState().scene;c.__r3f&&d(c,r,l)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var r;return!!((r=t==null?void 0:t.__r3f)!=null?r:{}).handlers},prepareUpdate(t,r,l,c){var f;if(((f=t==null?void 0:t.__r3f)!=null?f:{}).primitive&&c.object&&c.object!==t)return[!0];{const{args:h=[],children:o,...a}=c,{args:g=[],children:C,...S}=l;if(!Array.isArray(h))throw new Error("R3F: the args prop must be an array!");if(h.some((x,L)=>x!==g[L]))return[!0];const P=Fe(t,a,S,!0);return P.changes.length?[!1,P]:null}},commitUpdate(t,[r,l],c,f,E,h){r?u(t,c,E,h):ue(t,l)},commitMount(t,r,l,c){var f;const E=(f=t.__r3f)!=null?f:{};t.raycast&&E.handlers&&E.eventCount&&oe(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>$(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var r;const{attach:l,parent:c}=(r=t.__r3f)!=null?r:{};l&&c&&Re(c,t,l),t.isObject3D&&(t.visible=!1),Y(t)},unhideInstance(t,r){var l;const{attach:c,parent:f}=(l=t.__r3f)!=null?l:{};c&&f&&le(f,t,c),(t.isObject3D&&r.visible==null||r.visible)&&(t.visible=!0),Y(t)},createTextInstance:v,hideTextInstance:v,unhideTextInstance:v,getCurrentEventPriority:()=>n(),beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&j.fun(performance.now)?performance.now:j.fun(Date.now)?Date.now:()=>0,scheduleTimeout:j.fun(setTimeout)?setTimeout:void 0,cancelTimeout:j.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ue}}var Ce,Se;const ce=e=>"colorSpace"in e||"outputColorSpace"in e,Le=()=>{var e;return(e=we.ColorManagement)!=null?e:null},Te=e=>e&&e.isOrthographicCamera,gt=e=>e&&e.hasOwnProperty("current"),ee=typeof window<"u"&&((Ce=window.document)!=null&&Ce.createElement||((Se=window.navigator)==null?void 0:Se.product)==="ReactNative")?y.useLayoutEffect:y.useEffect;function ze(e){const n=y.useRef(e);return ee(()=>void(n.current=e),[e]),n}function wt({set:e}){return ee(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ke extends y.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}}ke.getDerivedStateFromError=()=>({error:!0});const De="__default",Pe=new Map,yt=e=>e&&!!e.memoized&&!!e.changes;function Ae(e){var n;const i=typeof window<"u"?(n=window.devicePixelRatio)!=null?n:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const Z=e=>{var n;return(n=e.__r3f)==null?void 0:n.root.getState()};function oe(e){let n=e.__r3f.root;for(;n.getState().previousRoot;)n=n.getState().previousRoot;return n}const j={obj:e=>e===Object(e)&&!j.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,n,{arrays:i="shallow",objects:s="reference",strict:d=!0}={}){if(typeof e!=typeof n||!!e!=!!n)return!1;if(j.str(e)||j.num(e)||j.boo(e))return e===n;const p=j.obj(e);if(p&&s==="reference")return e===n;const w=j.arr(e);if(w&&i==="reference")return e===n;if((w||p)&&e===n)return!0;let u;for(u in e)if(!(u in n))return!1;if(p&&i==="shallow"&&s==="shallow"){for(u in d?n:e)if(!j.equ(e[u],n[u],{strict:d,objects:"reference"}))return!1}else for(u in d?n:e)if(e[u]!==n[u])return!1;if(j.und(u)){if(w&&e.length===0&&n.length===0||p&&Object.keys(e).length===0&&Object.keys(n).length===0)return!0;if(e!==n)return!1}return!0}};function bt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const n in e)n.dispose==null||n.dispose(),delete e[n]}function $(e,n){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...n},e}function me(e,n){let i=e;if(n.includes("-")){const s=n.split("-"),d=s.pop();return i=s.reduce((p,w)=>p[w],e),{target:i,key:d}}else return{target:i,key:n}}const Me=/-\d+$/;function le(e,n,i){if(j.str(i)){if(Me.test(i)){const p=i.replace(Me,""),{target:w,key:u}=me(e,p);Array.isArray(w[u])||(w[u]=[])}const{target:s,key:d}=me(e,i);n.__r3f.previousAttach=s[d],s[d]=n}else n.__r3f.previousAttach=i(e,n)}function Re(e,n,i){var s,d;if(j.str(i)){const{target:p,key:w}=me(e,i),u=n.__r3f.previousAttach;u===void 0?delete p[w]:p[w]=u}else(s=n.__r3f)==null||s.previousAttach==null||s.previousAttach(e,n);(d=n.__r3f)==null||delete d.previousAttach}function Fe(e,{children:n,key:i,ref:s,...d},{children:p,key:w,ref:u,...v}={},m=!1){const t=e.__r3f,r=Object.entries(d),l=[];if(m){const f=Object.keys(v);for(let E=0;E<f.length;E++)d.hasOwnProperty(f[E])||r.unshift([f[E],De+"remove"])}r.forEach(([f,E])=>{var h;if((h=e.__r3f)!=null&&h.primitive&&f==="object"||j.equ(E,v[f]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(f))return l.push([f,E,!0,[]]);let o=[];f.includes("-")&&(o=f.split("-")),l.push([f,E,!1,o]);for(const a in d){const g=d[a];a.startsWith(`${f}-`)&&l.push([a,g,!1,a.split("-")])}});const c={...d};return t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.args&&(c.args=t.memoizedProps.args),t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.attach&&(c.attach=t.memoizedProps.attach),{memoized:c,changes:l}}function ue(e,n){var i;const s=e.__r3f,d=s==null?void 0:s.root,p=d==null||d.getState==null?void 0:d.getState(),{memoized:w,changes:u}=yt(n)?n:Fe(e,n),v=s==null?void 0:s.eventCount;e.__r3f&&(e.__r3f.memoizedProps=w);for(let l=0;l<u.length;l++){let[c,f,E,h]=u[l];if(ce(e)){const C="srgb",S="srgb-linear";c==="encoding"?(c="colorSpace",f=f===3001?C:S):c==="outputEncoding"&&(c="outputColorSpace",f=f===3001?C:S)}let o=e,a=o[c];if(h.length&&(a=h.reduce((g,C)=>g[C],e),!(a&&a.set))){const[g,...C]=h.reverse();o=C.reverse().reduce((S,P)=>S[P],e),c=g}if(f===De+"remove")if(o.constructor){let g=Pe.get(o.constructor);g||(g=new o.constructor,Pe.set(o.constructor,g)),f=g[c]}else f=0;if(E&&s)f?s.handlers[c]=f:delete s.handlers[c],s.eventCount=Object.keys(s.handlers).length;else if(a&&a.set&&(a.copy||a instanceof se)){if(Array.isArray(f))a.fromArray?a.fromArray(f):a.set(...f);else if(a.copy&&f&&f.constructor&&a.constructor===f.constructor)a.copy(f);else if(f!==void 0){var m;const g=(m=a)==null?void 0:m.isColor;!g&&a.setScalar?a.setScalar(f):a instanceof se&&f instanceof se?a.mask=f.mask:a.set(f),!Le()&&p&&!p.linear&&g&&a.convertSRGBToLinear()}}else{var t;if(o[c]=f,(t=o[c])!=null&&t.isTexture&&o[c].format===$e&&o[c].type===Ye&&p){const g=o[c];ce(g)&&ce(p.gl)?g.colorSpace=p.gl.outputColorSpace:g.encoding=p.gl.outputEncoding}}Y(e)}if(s&&s.parent&&e.raycast&&v!==s.eventCount){const l=oe(e).getState().internal,c=l.interaction.indexOf(e);c>-1&&l.interaction.splice(c,1),s.eventCount&&l.interaction.push(e)}return!(u.length===1&&u[0][0]==="onUpdate")&&u.length&&(i=e.__r3f)!=null&&i.parent&&ge(e),e}function Y(e){var n,i;const s=(n=e.__r3f)==null||(i=n.root)==null||i.getState==null?void 0:i.getState();s&&s.internal.frames===0&&s.invalidate()}function ge(e){e.onUpdate==null||e.onUpdate(e)}function Et(e,n){e.manual||(Te(e)?(e.left=n.width/-2,e.right=n.width/2,e.top=n.height/2,e.bottom=n.height/-2):e.aspect=n.width/n.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function te(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function _t(){var e;const n=typeof self<"u"&&self||typeof window<"u"&&window;if(!n)return Q.DefaultEventPriority;switch((e=n.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Q.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Q.ContinuousEventPriority;default:return Q.DefaultEventPriority}}function He(e,n,i,s){const d=i.get(n);d&&(i.delete(n),i.size===0&&(e.delete(s),d.target.releasePointerCapture(s)))}function Ct(e,n){const{internal:i}=e.getState();i.interaction=i.interaction.filter(s=>s!==n),i.initialHits=i.initialHits.filter(s=>s!==n),i.hovered.forEach((s,d)=>{(s.eventObject===n||s.object===n)&&i.hovered.delete(d)}),i.capturedMap.forEach((s,d)=>{He(i.capturedMap,n,s,d)})}function St(e){function n(v){const{internal:m}=e.getState(),t=v.offsetX-m.initialClick[0],r=v.offsetY-m.initialClick[1];return Math.round(Math.sqrt(t*t+r*r))}function i(v){return v.filter(m=>["Move","Over","Enter","Out","Leave"].some(t=>{var r;return(r=m.__r3f)==null?void 0:r.handlers["onPointer"+t]}))}function s(v,m){const t=e.getState(),r=new Set,l=[],c=m?m(t.internal.interaction):t.internal.interaction;for(let o=0;o<c.length;o++){const a=Z(c[o]);a&&(a.raycaster.camera=void 0)}t.previousRoot||t.events.compute==null||t.events.compute(v,t);function f(o){const a=Z(o);if(!a||!a.events.enabled||a.raycaster.camera===null)return[];if(a.raycaster.camera===void 0){var g;a.events.compute==null||a.events.compute(v,a,(g=a.previousRoot)==null?void 0:g.getState()),a.raycaster.camera===void 0&&(a.raycaster.camera=null)}return a.raycaster.camera?a.raycaster.intersectObject(o,!0):[]}let E=c.flatMap(f).sort((o,a)=>{const g=Z(o.object),C=Z(a.object);return!g||!C?o.distance-a.distance:C.events.priority-g.events.priority||o.distance-a.distance}).filter(o=>{const a=te(o);return r.has(a)?!1:(r.add(a),!0)});t.events.filter&&(E=t.events.filter(E,t));for(const o of E){let a=o.object;for(;a;){var h;(h=a.__r3f)!=null&&h.eventCount&&l.push({...o,eventObject:a}),a=a.parent}}if("pointerId"in v&&t.internal.capturedMap.has(v.pointerId))for(let o of t.internal.capturedMap.get(v.pointerId).values())r.has(te(o.intersection))||l.push(o.intersection);return l}function d(v,m,t,r){const l=e.getState();if(v.length){const c={stopped:!1};for(const f of v){const E=Z(f.object)||l,{raycaster:h,pointer:o,camera:a,internal:g}=E,C=new re(o.x,o.y,0).unproject(a),S=M=>{var b,R;return(b=(R=g.capturedMap.get(M))==null?void 0:R.has(f.eventObject))!=null?b:!1},P=M=>{const b={intersection:f,target:m.target};g.capturedMap.has(M)?g.capturedMap.get(M).set(f.eventObject,b):g.capturedMap.set(M,new Map([[f.eventObject,b]])),m.target.setPointerCapture(M)},x=M=>{const b=g.capturedMap.get(M);b&&He(g.capturedMap,f.eventObject,b,M)};let L={};for(let M in m){let b=m[M];typeof b!="function"&&(L[M]=b)}let O={...f,...L,pointer:o,intersections:v,stopped:c.stopped,delta:t,unprojectedPoint:C,ray:h.ray,camera:a,stopPropagation(){const M="pointerId"in m&&g.capturedMap.get(m.pointerId);if((!M||M.has(f.eventObject))&&(O.stopped=c.stopped=!0,g.hovered.size&&Array.from(g.hovered.values()).find(b=>b.eventObject===f.eventObject))){const b=v.slice(0,v.indexOf(f));p([...b,f])}},target:{hasPointerCapture:S,setPointerCapture:P,releasePointerCapture:x},currentTarget:{hasPointerCapture:S,setPointerCapture:P,releasePointerCapture:x},nativeEvent:m};if(r(O),c.stopped===!0)break}}return v}function p(v){const{internal:m}=e.getState();for(const t of m.hovered.values())if(!v.length||!v.find(r=>r.object===t.object&&r.index===t.index&&r.instanceId===t.instanceId)){const l=t.eventObject.__r3f,c=l==null?void 0:l.handlers;if(m.hovered.delete(te(t)),l!=null&&l.eventCount){const f={...t,intersections:v};c.onPointerOut==null||c.onPointerOut(f),c.onPointerLeave==null||c.onPointerLeave(f)}}}function w(v,m){for(let t=0;t<m.length;t++){const r=m[t].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(v)}}function u(v){switch(v){case"onPointerLeave":case"onPointerCancel":return()=>p([]);case"onLostPointerCapture":return m=>{const{internal:t}=e.getState();"pointerId"in m&&t.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{t.capturedMap.has(m.pointerId)&&(t.capturedMap.delete(m.pointerId),p([]))})}}return function(t){const{onPointerMissed:r,internal:l}=e.getState();l.lastEvent.current=t;const c=v==="onPointerMove",f=v==="onClick"||v==="onContextMenu"||v==="onDoubleClick",h=s(t,c?i:void 0),o=f?n(t):0;v==="onPointerDown"&&(l.initialClick=[t.offsetX,t.offsetY],l.initialHits=h.map(g=>g.eventObject)),f&&!h.length&&o<=2&&(w(t,l.interaction),r&&r(t)),c&&p(h);function a(g){const C=g.eventObject,S=C.__r3f,P=S==null?void 0:S.handlers;if(S!=null&&S.eventCount)if(c){if(P.onPointerOver||P.onPointerEnter||P.onPointerOut||P.onPointerLeave){const x=te(g),L=l.hovered.get(x);L?L.stopped&&g.stopPropagation():(l.hovered.set(x,g),P.onPointerOver==null||P.onPointerOver(g),P.onPointerEnter==null||P.onPointerEnter(g))}P.onPointerMove==null||P.onPointerMove(g)}else{const x=P[v];x?(!f||l.initialHits.includes(C))&&(w(t,l.interaction.filter(L=>!l.initialHits.includes(L))),x(g)):f&&l.initialHits.includes(C)&&w(t,l.interaction.filter(L=>!l.initialHits.includes(L)))}}d(h,t,o,a)}}return{handlePointer:u}}const Be=e=>!!(e!=null&&e.render),Ie=y.createContext(null),Pt=(e,n)=>{const i=We((u,v)=>{const m=new re,t=new re,r=new re;function l(o=v().camera,a=t,g=v().size){const{width:C,height:S,top:P,left:x}=g,L=C/S;a.isVector3?r.copy(a):r.set(...a);const O=o.getWorldPosition(m).distanceTo(r);if(Te(o))return{width:C/o.zoom,height:S/o.zoom,top:P,left:x,factor:1,distance:O,aspect:L};{const M=o.fov*Math.PI/180,b=2*Math.tan(M/2)*O,R=b*(C/S);return{width:R,height:b,top:P,left:x,factor:C/R,distance:O,aspect:L}}}let c;const f=o=>u(a=>({performance:{...a.performance,current:o}})),E=new at;return{set:u,get:v,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(o=1)=>e(v(),o),advance:(o,a)=>n(o,a,v()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ct,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const o=v();c&&clearTimeout(c),o.performance.current!==o.performance.min&&f(o.performance.min),c=setTimeout(()=>f(v().performance.max),o.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:o=>u(a=>({...a,events:{...a.events,...o}})),setSize:(o,a,g,C,S)=>{const P=v().camera,x={width:o,height:a,top:C||0,left:S||0,updateStyle:g};u(L=>({size:x,viewport:{...L.viewport,...l(P,t,x)}}))},setDpr:o=>u(a=>{const g=Ae(o);return{viewport:{...a.viewport,dpr:g,initialDpr:a.viewport.initialDpr||g}}}),setFrameloop:(o="always")=>{const a=v().clock;a.stop(),a.elapsedTime=0,o!=="never"&&(a.start(),a.elapsedTime=0),u(()=>({frameloop:o}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:y.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(o,a,g)=>{const C=v().internal;return C.priority=C.priority+(a>0?1:0),C.subscribers.push({ref:o,priority:a,store:g}),C.subscribers=C.subscribers.sort((S,P)=>S.priority-P.priority),()=>{const S=v().internal;S!=null&&S.subscribers&&(S.priority=S.priority-(a>0?1:0),S.subscribers=S.subscribers.filter(P=>P.ref!==o))}}}}}),s=i.getState();let d=s.size,p=s.viewport.dpr,w=s.camera;return i.subscribe(()=>{const{camera:u,size:v,viewport:m,gl:t,set:r}=i.getState();if(v.width!==d.width||v.height!==d.height||m.dpr!==p){var l;d=v,p=m.dpr,Et(u,v),t.setPixelRatio(m.dpr);const c=(l=v.updateStyle)!=null?l:typeof HTMLCanvasElement<"u"&&t.domElement instanceof HTMLCanvasElement;t.setSize(v.width,v.height,c)}u!==w&&(w=u,r(c=>({viewport:{...c.viewport,...c.viewport.getCurrentViewport(u)}})))}),i.subscribe(u=>e(u)),i};let ne,Mt=new Set,Rt=new Set,xt=new Set;function fe(e,n){if(e.size)for(const{callback:i}of e.values())i(n)}function J(e,n){switch(e){case"before":return fe(Mt,n);case"after":return fe(Rt,n);case"tail":return fe(xt,n)}}let de,pe;function ve(e,n,i){let s=n.clock.getDelta();for(n.frameloop==="never"&&typeof e=="number"&&(s=e-n.clock.elapsedTime,n.clock.oldTime=n.clock.elapsedTime,n.clock.elapsedTime=e),de=n.internal.subscribers,ne=0;ne<de.length;ne++)pe=de[ne],pe.ref.current(pe.store.getState(),s,i);return!n.internal.priority&&n.gl.render&&n.gl.render(n.scene,n.camera),n.internal.frames=Math.max(0,n.internal.frames-1),n.frameloop==="always"?1:n.internal.frames}function Ot(e){let n=!1,i=!1,s,d,p;function w(m){d=requestAnimationFrame(w),n=!0,s=0,J("before",m),i=!0;for(const r of e.values()){var t;p=r.store.getState(),p.internal.active&&(p.frameloop==="always"||p.internal.frames>0)&&!((t=p.gl.xr)!=null&&t.isPresenting)&&(s+=ve(m,p))}if(i=!1,J("after",m),s===0)return J("tail",m),n=!1,cancelAnimationFrame(d)}function u(m,t=1){var r;if(!m)return e.forEach(l=>u(l.store.getState(),t));(r=m.gl.xr)!=null&&r.isPresenting||!m.internal.active||m.frameloop==="never"||(t>1?m.internal.frames=Math.min(60,m.internal.frames+t):i?m.internal.frames=2:m.internal.frames=1,n||(n=!0,requestAnimationFrame(w)))}function v(m,t=!0,r,l){if(t&&J("before",m),r)ve(m,r,l);else for(const c of e.values())ve(m,c.store.getState());t&&J("after",m)}return{loop:w,invalidate:u,advance:v}}function Ne(){const e=y.useContext(Ie);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function I(e=i=>i,n){return Ne()(e,n)}function jt(e,n=0){const i=Ne(),s=i.getState().internal.subscribe,d=ze(e);return ee(()=>s(d,n,i),[n,s,i]),null}const K=new Map,{invalidate:xe,advance:Oe}=Ot(K),{reconciler:ie,applyProps:V}=mt(K,_t),X={objects:"shallow",strict:!1},Lt=(e,n)=>{const i=typeof e=="function"?e(n):e;return Be(i)?i:new nt({powerPreference:"high-performance",canvas:n,antialias:!0,alpha:!0,...e})};function Tt(e,n){const i=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(n){const{width:s,height:d,top:p,left:w,updateStyle:u=i}=n;return{width:s,height:d,top:p,left:w,updateStyle:u}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:s,height:d,top:p,left:w}=e.parentElement.getBoundingClientRect();return{width:s,height:d,top:p,left:w,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function zt(e){const n=K.get(e),i=n==null?void 0:n.fiber,s=n==null?void 0:n.store;n&&console.warn("R3F.createRoot should only be called once!");const d=typeof reportError=="function"?reportError:console.error,p=s||Pt(xe,Oe),w=i||ie.createContainer(p,Q.ConcurrentRoot,null,!1,null,"",d,null);n||K.set(e,{fiber:w,store:p});let u,v=!1,m;return{configure(t={}){let{gl:r,size:l,scene:c,events:f,onCreated:E,shadows:h=!1,linear:o=!1,flat:a=!1,legacy:g=!1,orthographic:C=!1,frameloop:S="always",dpr:P=[1,2],performance:x,raycaster:L,camera:O,onPointerMissed:M}=t,b=p.getState(),R=b.gl;b.gl||b.set({gl:R=Lt(r,e)});let D=b.raycaster;D||b.set({raycaster:D=new Ke});const{params:q,...T}=L||{};if(j.equ(T,D,X)||V(D,{...T}),j.equ(q,D.params,X)||V(D,{params:{...D.params,...q}}),!b.camera||b.camera===m&&!j.equ(m,O,X)){m=O;const z=O instanceof rt,_=z?O:C?new Ze(0,0,0,0,.1,1e3):new Je(75,0,.1,1e3);z||(_.position.z=5,O&&(V(_,O),("aspect"in O||"left"in O||"right"in O||"bottom"in O||"top"in O)&&(_.manual=!0,_.updateProjectionMatrix())),!b.camera&&!(O!=null&&O.rotation)&&_.lookAt(0,0,0)),b.set({camera:_}),D.camera=_}if(!b.scene){let z;c!=null&&c.isScene?z=c:(z=new Qe,c&&V(z,c)),b.set({scene:$(z)})}if(!b.xr){var U;const z=(k,W)=>{const B=p.getState();B.frameloop!=="never"&&Oe(k,!0,B,W)},_=()=>{const k=p.getState();k.gl.xr.enabled=k.gl.xr.isPresenting,k.gl.xr.setAnimationLoop(k.gl.xr.isPresenting?z:null),k.gl.xr.isPresenting||xe(k)},H={connect(){const k=p.getState().gl;k.xr.addEventListener("sessionstart",_),k.xr.addEventListener("sessionend",_)},disconnect(){const k=p.getState().gl;k.xr.removeEventListener("sessionstart",_),k.xr.removeEventListener("sessionend",_)}};typeof((U=R.xr)==null?void 0:U.addEventListener)=="function"&&H.connect(),b.set({xr:H})}if(R.shadowMap){const z=R.shadowMap.enabled,_=R.shadowMap.type;if(R.shadowMap.enabled=!!h,j.boo(h))R.shadowMap.type=ae;else if(j.str(h)){var G;const H={basic:ot,percentage:it,soft:ae,variance:st};R.shadowMap.type=(G=H[h])!=null?G:ae}else j.obj(h)&&Object.assign(R.shadowMap,h);(z!==R.shadowMap.enabled||_!==R.shadowMap.type)&&(R.shadowMap.needsUpdate=!0)}const A=Le();A&&("enabled"in A?A.enabled=!g:"legacyMode"in A&&(A.legacyMode=g)),v||V(R,{outputEncoding:o?3e3:3001,toneMapping:a?et:tt}),b.legacy!==g&&b.set(()=>({legacy:g})),b.linear!==o&&b.set(()=>({linear:o})),b.flat!==a&&b.set(()=>({flat:a})),r&&!j.fun(r)&&!Be(r)&&!j.equ(r,R,X)&&V(R,r),f&&!b.events.handlers&&b.set({events:f(p)});const F=Tt(e,l);return j.equ(F,b.size,X)||b.setSize(F.width,F.height,F.updateStyle,F.top,F.left),P&&b.viewport.dpr!==Ae(P)&&b.setDpr(P),b.frameloop!==S&&b.setFrameloop(S),b.onPointerMissed||b.set({onPointerMissed:M}),x&&!j.equ(x,b.performance,X)&&b.set(z=>({performance:{...z.performance,...x}})),u=E,v=!0,this},render(t){return v||this.configure(),ie.updateContainer(N.jsx(kt,{store:p,children:t,onCreated:u,rootElement:e}),w,null,()=>{}),p},unmount(){Ue(e)}}}function kt({store:e,children:n,onCreated:i,rootElement:s}){return ee(()=>{const d=e.getState();d.set(p=>({internal:{...p.internal,active:!0}})),i&&i(d),e.getState().events.connected||d.events.connect==null||d.events.connect(s)},[]),N.jsx(Ie.Provider,{value:e,children:n})}function Ue(e,n){const i=K.get(e),s=i==null?void 0:i.fiber;if(s){const d=i==null?void 0:i.store.getState();d&&(d.internal.active=!1),ie.updateContainer(null,s,null,()=>{d&&setTimeout(()=>{try{var p,w,u,v;d.events.disconnect==null||d.events.disconnect(),(p=d.gl)==null||(w=p.renderLists)==null||w.dispose==null||w.dispose(),(u=d.gl)==null||u.forceContextLoss==null||u.forceContextLoss(),(v=d.gl)!=null&&v.xr&&d.xr.disconnect(),bt(d),K.delete(e)}catch{}},500)})}}ie.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:y.version});const he={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Dt(e){const{handlePointer:n}=St(e);return{priority:1,enabled:!0,compute(i,s,d){s.pointer.set(i.offsetX/s.size.width*2-1,-(i.offsetY/s.size.height)*2+1),s.raycaster.setFromCamera(s.pointer,s.camera)},connected:void 0,handlers:Object.keys(he).reduce((i,s)=>({...i,[s]:n(s)}),{}),update:()=>{var i;const{events:s,internal:d}=e.getState();(i=d.lastEvent)!=null&&i.current&&s.handlers&&s.handlers.onPointerMove(d.lastEvent.current)},connect:i=>{var s;const{set:d,events:p}=e.getState();p.disconnect==null||p.disconnect(),d(w=>({events:{...w.events,connected:i}})),Object.entries((s=p.handlers)!=null?s:[]).forEach(([w,u])=>{const[v,m]=he[w];i.addEventListener(v,u,{passive:m})})},disconnect:()=>{const{set:i,events:s}=e.getState();if(s.connected){var d;Object.entries((d=s.handlers)!=null?d:[]).forEach(([p,w])=>{if(s&&s.connected instanceof HTMLElement){const[u]=he[p];s.connected.removeEventListener(u,w)}}),i(p=>({events:{...p.events,connected:void 0}}))}}}}function At({debounce:e,scroll:n,polyfill:i,offsetSize:s}={debounce:0,scroll:!1,offsetSize:!1}){const d=i||typeof window<"u"&&window.ResizeObserver,[p,w]=y.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!d)return p.width=1280,p.height=800,[()=>{},p,()=>{}];const u=y.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:p,orientationHandler:null}),v=e?typeof e=="number"?e:e.scroll:null,m=e?typeof e=="number"?e:e.resize:null,t=y.useRef(!1);y.useEffect(()=>(t.current=!0,()=>void(t.current=!1)));const[r,l,c]=y.useMemo(()=>{const o=()=>{if(!u.current.element)return;const{left:a,top:g,width:C,height:S,bottom:P,right:x,x:L,y:O}=u.current.element.getBoundingClientRect(),M={left:a,top:g,width:C,height:S,bottom:P,right:x,x:L,y:O};u.current.element instanceof HTMLElement&&s&&(M.height=u.current.element.offsetHeight,M.width=u.current.element.offsetWidth),Object.freeze(M),t.current&&!It(u.current.lastBounds,M)&&w(u.current.lastBounds=M)};return[o,m?_e(o,m):o,v?_e(o,v):o]},[w,s,v,m]);function f(){u.current.scrollContainers&&(u.current.scrollContainers.forEach(o=>o.removeEventListener("scroll",c,!0)),u.current.scrollContainers=null),u.current.resizeObserver&&(u.current.resizeObserver.disconnect(),u.current.resizeObserver=null),u.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",u.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",u.current.orientationHandler))}function E(){var o;u.current.element&&(u.current.resizeObserver=new d(l),(o=u.current.resizeObserver)==null||o.observe(u.current.element),n&&u.current.scrollContainers&&u.current.scrollContainers.forEach(a=>a.addEventListener("scroll",c,{capture:!0,passive:!0})),u.current.orientationHandler=()=>{c()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",u.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",u.current.orientationHandler))}const h=o=>{!o||o===u.current.element||(f(),u.current.element=o,u.current.scrollContainers=qe(o),E())};return Ht(c,!!n),Ft(l),y.useEffect(()=>{f(),E()},[n,c,l]),y.useEffect(()=>f,[]),[h,p,r]}function Ft(e){y.useEffect(()=>{const n=e;return window.addEventListener("resize",n),()=>void window.removeEventListener("resize",n)},[e])}function Ht(e,n){y.useEffect(()=>{if(n){const i=e;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[e,n])}function qe(e){const n=[];if(!e||e===document.body)return n;const{overflow:i,overflowX:s,overflowY:d}=window.getComputedStyle(e);return[i,s,d].some(p=>p==="auto"||p==="scroll")&&n.push(e),[...n,...qe(e.parentElement)]}const Bt=["x","y","top","bottom","left","right","width","height"],It=(e,n)=>Bt.every(i=>e[i]===n[i]),Nt=y.forwardRef(function({children:n,fallback:i,resize:s,style:d,gl:p,events:w=Dt,eventSource:u,eventPrefix:v,shadows:m,linear:t,flat:r,legacy:l,orthographic:c,frameloop:f,dpr:E,performance:h,raycaster:o,camera:a,scene:g,onPointerMissed:C,onCreated:S,...P},x){y.useMemo(()=>ht(lt),[]);const L=Xe(),[O,M]=At({scroll:!0,debounce:{scroll:50,resize:0},...s}),b=y.useRef(null),R=y.useRef(null);y.useImperativeHandle(x,()=>b.current);const D=ze(C),[q,T]=y.useState(!1),[U,G]=y.useState(!1);if(q)throw q;if(U)throw U;const A=y.useRef(null);ee(()=>{const z=b.current;M.width>0&&M.height>0&&z&&(A.current||(A.current=zt(z)),A.current.configure({gl:p,events:w,shadows:m,linear:t,flat:r,legacy:l,orthographic:c,frameloop:f,dpr:E,performance:h,raycaster:o,camera:a,scene:g,size:M,onPointerMissed:(..._)=>D.current==null?void 0:D.current(..._),onCreated:_=>{_.events.connect==null||_.events.connect(u?gt(u)?u.current:u:R.current),v&&_.setEvents({compute:(H,k)=>{const W=H[v+"X"],B=H[v+"Y"];k.pointer.set(W/k.size.width*2-1,-(B/k.size.height)*2+1),k.raycaster.setFromCamera(k.pointer,k.camera)}}),S==null||S(_)}}),A.current.render(N.jsx(L,{children:N.jsx(ke,{set:G,children:N.jsx(y.Suspense,{fallback:N.jsx(wt,{set:T}),children:n})})})))}),y.useEffect(()=>{const z=b.current;if(z)return()=>Ue(z)},[]);const F=u?"none":"auto";return N.jsx("div",{ref:R,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:F,...d},...P,children:N.jsx("div",{ref:O,style:{width:"100%",height:"100%"},children:N.jsx("canvas",{ref:b,style:{display:"block"},children:i})})})}),Xt=y.forwardRef(function(n,i){return N.jsx(Ve,{children:N.jsx(Nt,{...n,ref:i})})});function Ut(e,n,i){const s=I(l=>l.size),d=I(l=>l.viewport),p=typeof e=="number"?e:s.width*d.dpr,w=s.height*d.dpr,u=(typeof e=="number"?i:e)||{},{samples:v=0,depth:m,...t}=u,r=y.useMemo(()=>{const l=new ut(p,w,{minFilter:ye,magFilter:ye,type:ft,...t});return m&&(l.depthTexture=new dt(p,w,pt)),l.samples=v,l},[]);return y.useLayoutEffect(()=>{r.setSize(p,w),v&&(r.samples=v)},[v,r,p,w]),y.useEffect(()=>()=>r.dispose(),[]),r}const qt=e=>typeof e=="function",$t=y.forwardRef(({envMap:e,resolution:n=256,frames:i=1/0,makeDefault:s,children:d,...p},w)=>{const u=I(({set:h})=>h),v=I(({camera:h})=>h),m=I(({size:h})=>h),t=y.useRef(null);y.useImperativeHandle(w,()=>t.current,[]);const r=y.useRef(null),l=Ut(n);y.useLayoutEffect(()=>{p.manual||(t.current.aspect=m.width/m.height)},[m,p]),y.useLayoutEffect(()=>{t.current.updateProjectionMatrix()});let c=0,f=null;const E=qt(d);return jt(h=>{E&&(i===1/0||c<i)&&(r.current.visible=!1,h.gl.setRenderTarget(l),f=h.scene.background,e&&(h.scene.background=e),h.gl.render(h.scene,t.current),h.scene.background=f,h.gl.setRenderTarget(null),r.current.visible=!0,c++)}),y.useLayoutEffect(()=>{if(s){const h=v;return u(()=>({camera:t.current})),()=>u(()=>({camera:h}))}},[t,s,u]),y.createElement(y.Fragment,null,y.createElement("perspectiveCamera",je({ref:t},p),!E&&d),y.createElement("group",{ref:r},E&&d(l.texture)))}),Yt=y.forwardRef(({children:e,domElement:n,onChange:i,onMouseDown:s,onMouseUp:d,onObjectChange:p,object:w,makeDefault:u,camera:v,enabled:m,axis:t,mode:r,translationSnap:l,rotationSnap:c,scaleSnap:f,space:E,size:h,showX:o,showY:a,showZ:g,...C},S)=>{const P=I(_=>_.controls),x=I(_=>_.gl),L=I(_=>_.events),O=I(_=>_.camera),M=I(_=>_.invalidate),b=I(_=>_.get),R=I(_=>_.set),D=v||O,q=n||L.connected||x.domElement,T=y.useMemo(()=>new vt(D,q),[D,q]),U=y.useRef(null);y.useLayoutEffect(()=>(w?T.attach(w instanceof be?w:w.current):U.current instanceof be&&T.attach(U.current),()=>void T.detach()),[w,e,T]),y.useEffect(()=>{if(P){const _=H=>P.enabled=!H.value;return T.addEventListener("dragging-changed",_),()=>T.removeEventListener("dragging-changed",_)}},[T,P]);const G=y.useRef(),A=y.useRef(),F=y.useRef(),z=y.useRef();return y.useLayoutEffect(()=>void(G.current=i),[i]),y.useLayoutEffect(()=>void(A.current=s),[s]),y.useLayoutEffect(()=>void(F.current=d),[d]),y.useLayoutEffect(()=>void(z.current=p),[p]),y.useEffect(()=>{const _=B=>{M(),G.current==null||G.current(B)},H=B=>A.current==null?void 0:A.current(B),k=B=>F.current==null?void 0:F.current(B),W=B=>z.current==null?void 0:z.current(B);return T.addEventListener("change",_),T.addEventListener("mouseDown",H),T.addEventListener("mouseUp",k),T.addEventListener("objectChange",W),()=>{T.removeEventListener("change",_),T.removeEventListener("mouseDown",H),T.removeEventListener("mouseUp",k),T.removeEventListener("objectChange",W)}},[M,T]),y.useEffect(()=>{if(u){const _=b().controls;return R({controls:T}),()=>R({controls:_})}},[u,T]),y.createElement(y.Fragment,null,y.createElement("primitive",{ref:S,object:T,enabled:m,axis:t,mode:r,translationSnap:l,rotationSnap:c,scaleSnap:f,space:E,size:h,showX:o,showY:a,showZ:g}),y.createElement("group",je({ref:U},C),e))});export{Xt as C,$t as P,Yt as T,I as u};
