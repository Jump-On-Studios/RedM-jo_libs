import{r as b,c as K,j as N,a as Ue,R as qe,F as Ge,u as Ve,b as We}from"./index-react.js";import{R as Xe,O as $e,P as Ye,S as Ke,a as se,V as Ze,b as Je,B as Qe,N as et,A as tt,W as nt,C as rt,c as re,d as ot,e as it,L as ae,f as st,U as at,T as ct,g as lt,H as ut,h as we,D as ft,F as dt,i as pt,j as be}from"./index-threejs.js";import{s as _e,_ as je}from"./index2.js";const ye={},vt=e=>void Object.assign(ye,e);function ht(e,n){function i(t,{args:r=[],attach:c,...l},u){let _=`${t[0].toUpperCase()}${t.slice(1)}`,v;if(t==="primitive"){if(l.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=l.object;v=$(s,{type:t,root:u,attach:c,primitive:!0})}else{const s=ye[_];if(!s)throw new Error(`R3F: ${_} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");v=$(new s(...r),{type:t,root:u,attach:c,memoizedProps:{args:r}})}return v.__r3f.attach===void 0&&(v.isBufferGeometry?v.__r3f.attach="geometry":v.isMaterial&&(v.__r3f.attach="material")),_!=="inject"&&ue(v,l),v}function o(t,r){let c=!1;if(r){var l,u;(l=r.__r3f)!=null&&l.attach?le(t,r,r.__r3f.attach):r.isObject3D&&t.isObject3D&&(t.add(r),c=!0),c||(u=t.__r3f)==null||u.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=t,ge(r),Y(r)}}function f(t,r,c){let l=!1;if(r){var u,_;if((u=r.__r3f)!=null&&u.attach)le(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){r.parent=t,r.dispatchEvent({type:"added"}),t.dispatchEvent({type:"childadded",child:r});const v=t.children.filter(a=>a!==r),s=v.indexOf(c);t.children=[...v.slice(0,s),r,...v.slice(s)],l=!0}l||(_=t.__r3f)==null||_.objects.push(r),r.__r3f||$(r,{}),r.__r3f.parent=t,ge(r),Y(r)}}function p(t,r,c=!1){t&&[...t].forEach(l=>y(r,l,c))}function y(t,r,c){if(r){var l,u,_;if(r.__r3f&&(r.__r3f.parent=null),(l=t.__r3f)!=null&&l.objects&&(t.__r3f.objects=t.__r3f.objects.filter(C=>C!==r)),(u=r.__r3f)!=null&&u.attach)Me(t,r,r.__r3f.attach);else if(r.isObject3D&&t.isObject3D){var v;t.remove(r),(v=r.__r3f)!=null&&v.root&&Et(oe(r),r)}const a=(_=r.__r3f)==null?void 0:_.primitive,g=!a&&(c===void 0?r.dispose!==null:c);if(!a){var s;p((s=r.__r3f)==null?void 0:s.objects,r,g),p(r.children,r,g)}if(delete r.__r3f,g&&r.dispose&&r.type!=="Scene"){const C=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?_e.unstable_scheduleCallback(_e.unstable_IdlePriority,C):C()}Y(t)}}function m(t,r,c,l){var u;const _=(u=t.__r3f)==null?void 0:u.parent;if(!_)return;const v=i(r,c,t.__r3f.root);if(t.children){for(const s of t.children)s.__r3f&&o(v,s);t.children=t.children.filter(s=>!s.__r3f)}t.__r3f.objects.forEach(s=>o(v,s)),t.__r3f.objects=[],t.__r3f.autoRemovedBeforeAppend||y(_,t),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),o(_,v),v.raycast&&v.__r3f.eventCount&&oe(v).getState().internal.interaction.push(v),[l,l.alternate].forEach(s=>{s!==null&&(s.stateNode=v,s.ref&&(typeof s.ref=="function"?s.ref(v):s.ref.current=v))})}const d=()=>{};return{reconciler:qe({createInstance:i,removeChild:y,appendChild:o,appendInitialChild:o,insertBefore:f,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(t,r)=>{if(!r)return;const c=t.getState().scene;c.__r3f&&(c.__r3f.root=t,o(c,r))},removeChildFromContainer:(t,r)=>{r&&y(t.getState().scene,r)},insertInContainerBefore:(t,r,c)=>{if(!r||!c)return;const l=t.getState().scene;l.__r3f&&f(l,r,c)},getRootHostContext:()=>null,getChildHostContext:t=>t,finalizeInitialChildren(t){var r;return!!((r=t==null?void 0:t.__r3f)!=null?r:{}).handlers},prepareUpdate(t,r,c,l){var u;if(((u=t==null?void 0:t.__r3f)!=null?u:{}).primitive&&l.object&&l.object!==t)return[!0];{const{args:v=[],children:s,...a}=l,{args:g=[],children:C,...S}=c;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((j,D)=>j!==g[D]))return[!0];const P=Fe(t,a,S,!0);return P.changes.length?[!1,P]:null}},commitUpdate(t,[r,c],l,u,_,v){r?m(t,l,_,v):ue(t,c)},commitMount(t,r,c,l){var u;const _=(u=t.__r3f)!=null?u:{};t.raycast&&_.handlers&&_.eventCount&&oe(t).getState().internal.interaction.push(t)},getPublicInstance:t=>t,prepareForCommit:()=>null,preparePortalMount:t=>$(t.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(t){var r;const{attach:c,parent:l}=(r=t.__r3f)!=null?r:{};c&&l&&Me(l,t,c),t.isObject3D&&(t.visible=!1),Y(t)},unhideInstance(t,r){var c;const{attach:l,parent:u}=(c=t.__r3f)!=null?c:{};l&&u&&le(u,t,l),(t.isObject3D&&r.visible==null||r.visible)&&(t.visible=!0),Y(t)},createTextInstance:d,hideTextInstance:d,unhideTextInstance:d,getCurrentEventPriority:()=>n?n():K.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&R.fun(performance.now)?performance.now:R.fun(Date.now)?Date.now:()=>0,scheduleTimeout:R.fun(setTimeout)?setTimeout:void 0,cancelTimeout:R.fun(clearTimeout)?clearTimeout:void 0}),applyProps:ue}}var Ee,Ce;const ce=e=>"colorSpace"in e||"outputColorSpace"in e,Oe=()=>{var e;return(e=ye.ColorManagement)!=null?e:null},Te=e=>e&&e.isOrthographicCamera,mt=e=>e&&e.hasOwnProperty("current"),ee=typeof window<"u"&&((Ee=window.document)!=null&&Ee.createElement||((Ce=window.navigator)==null?void 0:Ce.product)==="ReactNative")?b.useLayoutEffect:b.useEffect;function Le(e){const n=b.useRef(e);return ee(()=>void(n.current=e),[e]),n}function gt({set:e}){return ee(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ke extends b.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}}ke.getDerivedStateFromError=()=>({error:!0});const De="__default",Se=new Map,yt=e=>e&&!!e.memoized&&!!e.changes;function Ae(e){var n;const i=typeof window<"u"?(n=window.devicePixelRatio)!=null?n:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],i),e[1]):e}const J=e=>{var n;return(n=e.__r3f)==null?void 0:n.root.getState()};function oe(e){let n=e.__r3f.root;for(;n.getState().previousRoot;)n=n.getState().previousRoot;return n}const R={obj:e=>e===Object(e)&&!R.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,n,{arrays:i="shallow",objects:o="reference",strict:f=!0}={}){if(typeof e!=typeof n||!!e!=!!n)return!1;if(R.str(e)||R.num(e)||R.boo(e))return e===n;const p=R.obj(e);if(p&&o==="reference")return e===n;const y=R.arr(e);if(y&&i==="reference")return e===n;if((y||p)&&e===n)return!0;let m;for(m in e)if(!(m in n))return!1;if(p&&i==="shallow"&&o==="shallow"){for(m in f?n:e)if(!R.equ(e[m],n[m],{strict:f,objects:"reference"}))return!1}else for(m in f?n:e)if(e[m]!==n[m])return!1;if(R.und(m)){if(y&&e.length===0&&n.length===0||p&&Object.keys(e).length===0&&Object.keys(n).length===0)return!0;if(e!==n)return!1}return!0}};function wt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const n in e)n.dispose==null||n.dispose(),delete e[n]}function $(e,n){const i=e;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...n},e}function me(e,n){let i=e;if(n.includes("-")){const o=n.split("-"),f=o.pop();return i=o.reduce((p,y)=>p[y],e),{target:i,key:f}}else return{target:i,key:n}}const Pe=/-\d+$/;function le(e,n,i){if(R.str(i)){if(Pe.test(i)){const p=i.replace(Pe,""),{target:y,key:m}=me(e,p);Array.isArray(y[m])||(y[m]=[])}const{target:o,key:f}=me(e,i);n.__r3f.previousAttach=o[f],o[f]=n}else n.__r3f.previousAttach=i(e,n)}function Me(e,n,i){var o,f;if(R.str(i)){const{target:p,key:y}=me(e,i),m=n.__r3f.previousAttach;m===void 0?delete p[y]:p[y]=m}else(o=n.__r3f)==null||o.previousAttach==null||o.previousAttach(e,n);(f=n.__r3f)==null||delete f.previousAttach}function Fe(e,{children:n,key:i,ref:o,...f},{children:p,key:y,ref:m,...d}={},h=!1){const t=e.__r3f,r=Object.entries(f),c=[];if(h){const u=Object.keys(d);for(let _=0;_<u.length;_++)f.hasOwnProperty(u[_])||r.unshift([u[_],De+"remove"])}r.forEach(([u,_])=>{var v;if((v=e.__r3f)!=null&&v.primitive&&u==="object"||R.equ(_,d[u]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(u))return c.push([u,_,!0,[]]);let s=[];u.includes("-")&&(s=u.split("-")),c.push([u,_,!1,s]);for(const a in f){const g=f[a];a.startsWith(`${u}-`)&&c.push([a,g,!1,a.split("-")])}});const l={...f};return t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.args&&(l.args=t.memoizedProps.args),t!=null&&t.memoizedProps&&t!=null&&t.memoizedProps.attach&&(l.attach=t.memoizedProps.attach),{memoized:l,changes:c}}function ue(e,n){var i;const o=e.__r3f,f=o==null?void 0:o.root,p=f==null||f.getState==null?void 0:f.getState(),{memoized:y,changes:m}=yt(n)?n:Fe(e,n),d=o==null?void 0:o.eventCount;e.__r3f&&(e.__r3f.memoizedProps=y);for(let c=0;c<m.length;c++){let[l,u,_,v]=m[c];if(ce(e)){const C="srgb",S="srgb-linear";l==="encoding"?(l="colorSpace",u=u===3001?C:S):l==="outputEncoding"&&(l="outputColorSpace",u=u===3001?C:S)}let s=e,a=s[l];if(v.length&&(a=v.reduce((g,C)=>g[C],e),!(a&&a.set))){const[g,...C]=v.reverse();s=C.reverse().reduce((S,P)=>S[P],e),l=g}if(u===De+"remove")if(s.constructor){let g=Se.get(s.constructor);g||(g=new s.constructor,Se.set(s.constructor,g)),u=g[l]}else u=0;if(_&&o)u?o.handlers[l]=u:delete o.handlers[l],o.eventCount=Object.keys(o.handlers).length;else if(a&&a.set&&(a.copy||a instanceof ae)){if(Array.isArray(u))a.fromArray?a.fromArray(u):a.set(...u);else if(a.copy&&u&&u.constructor&&a.constructor===u.constructor)a.copy(u);else if(u!==void 0){var h;const g=(h=a)==null?void 0:h.isColor;!g&&a.setScalar?a.setScalar(u):a instanceof ae&&u instanceof ae?a.mask=u.mask:a.set(u),!Oe()&&p&&!p.linear&&g&&a.convertSRGBToLinear()}}else{var t;if(s[l]=u,(t=s[l])!=null&&t.isTexture&&s[l].format===st&&s[l].type===at&&p){const g=s[l];ce(g)&&ce(p.gl)?g.colorSpace=p.gl.outputColorSpace:g.encoding=p.gl.outputEncoding}}Y(e)}if(o&&o.parent&&e.raycast&&d!==o.eventCount){const c=oe(e).getState().internal,l=c.interaction.indexOf(e);l>-1&&c.interaction.splice(l,1),o.eventCount&&c.interaction.push(e)}return!(m.length===1&&m[0][0]==="onUpdate")&&m.length&&(i=e.__r3f)!=null&&i.parent&&ge(e),e}function Y(e){var n,i;const o=(n=e.__r3f)==null||(i=n.root)==null||i.getState==null?void 0:i.getState();o&&o.internal.frames===0&&o.invalidate()}function ge(e){e.onUpdate==null||e.onUpdate(e)}function bt(e,n){e.manual||(Te(e)?(e.left=n.width/-2,e.right=n.width/2,e.top=n.height/2,e.bottom=n.height/-2):e.aspect=n.width/n.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function te(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function _t(){var e;const n=typeof self<"u"&&self||typeof window<"u"&&window;if(!n)return K.DefaultEventPriority;switch((e=n.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return K.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return K.ContinuousEventPriority;default:return K.DefaultEventPriority}}function ze(e,n,i,o){const f=i.get(n);f&&(i.delete(n),i.size===0&&(e.delete(o),f.target.releasePointerCapture(o)))}function Et(e,n){const{internal:i}=e.getState();i.interaction=i.interaction.filter(o=>o!==n),i.initialHits=i.initialHits.filter(o=>o!==n),i.hovered.forEach((o,f)=>{(o.eventObject===n||o.object===n)&&i.hovered.delete(f)}),i.capturedMap.forEach((o,f)=>{ze(i.capturedMap,n,o,f)})}function Ct(e){function n(d){const{internal:h}=e.getState(),t=d.offsetX-h.initialClick[0],r=d.offsetY-h.initialClick[1];return Math.round(Math.sqrt(t*t+r*r))}function i(d){return d.filter(h=>["Move","Over","Enter","Out","Leave"].some(t=>{var r;return(r=h.__r3f)==null?void 0:r.handlers["onPointer"+t]}))}function o(d,h){const t=e.getState(),r=new Set,c=[],l=h?h(t.internal.interaction):t.internal.interaction;for(let s=0;s<l.length;s++){const a=J(l[s]);a&&(a.raycaster.camera=void 0)}t.previousRoot||t.events.compute==null||t.events.compute(d,t);function u(s){const a=J(s);if(!a||!a.events.enabled||a.raycaster.camera===null)return[];if(a.raycaster.camera===void 0){var g;a.events.compute==null||a.events.compute(d,a,(g=a.previousRoot)==null?void 0:g.getState()),a.raycaster.camera===void 0&&(a.raycaster.camera=null)}return a.raycaster.camera?a.raycaster.intersectObject(s,!0):[]}let _=l.flatMap(u).sort((s,a)=>{const g=J(s.object),C=J(a.object);return!g||!C?s.distance-a.distance:C.events.priority-g.events.priority||s.distance-a.distance}).filter(s=>{const a=te(s);return r.has(a)?!1:(r.add(a),!0)});t.events.filter&&(_=t.events.filter(_,t));for(const s of _){let a=s.object;for(;a;){var v;(v=a.__r3f)!=null&&v.eventCount&&c.push({...s,eventObject:a}),a=a.parent}}if("pointerId"in d&&t.internal.capturedMap.has(d.pointerId))for(let s of t.internal.capturedMap.get(d.pointerId).values())r.has(te(s.intersection))||c.push(s.intersection);return c}function f(d,h,t,r){const c=e.getState();if(d.length){const l={stopped:!1};for(const u of d){const _=J(u.object)||c,{raycaster:v,pointer:s,camera:a,internal:g}=_,C=new re(s.x,s.y,0).unproject(a),S=x=>{var w,M;return(w=(M=g.capturedMap.get(x))==null?void 0:M.has(u.eventObject))!=null?w:!1},P=x=>{const w={intersection:u,target:h.target};g.capturedMap.has(x)?g.capturedMap.get(x).set(u.eventObject,w):g.capturedMap.set(x,new Map([[u.eventObject,w]])),h.target.setPointerCapture(x)},j=x=>{const w=g.capturedMap.get(x);w&&ze(g.capturedMap,u.eventObject,w,x)};let D={};for(let x in h){let w=h[x];typeof w!="function"&&(D[x]=w)}let O={...u,...D,pointer:s,intersections:d,stopped:l.stopped,delta:t,unprojectedPoint:C,ray:v.ray,camera:a,stopPropagation(){const x="pointerId"in h&&g.capturedMap.get(h.pointerId);if((!x||x.has(u.eventObject))&&(O.stopped=l.stopped=!0,g.hovered.size&&Array.from(g.hovered.values()).find(w=>w.eventObject===u.eventObject))){const w=d.slice(0,d.indexOf(u));p([...w,u])}},target:{hasPointerCapture:S,setPointerCapture:P,releasePointerCapture:j},currentTarget:{hasPointerCapture:S,setPointerCapture:P,releasePointerCapture:j},nativeEvent:h};if(r(O),l.stopped===!0)break}}return d}function p(d){const{internal:h}=e.getState();for(const t of h.hovered.values())if(!d.length||!d.find(r=>r.object===t.object&&r.index===t.index&&r.instanceId===t.instanceId)){const c=t.eventObject.__r3f,l=c==null?void 0:c.handlers;if(h.hovered.delete(te(t)),c!=null&&c.eventCount){const u={...t,intersections:d};l.onPointerOut==null||l.onPointerOut(u),l.onPointerLeave==null||l.onPointerLeave(u)}}}function y(d,h){for(let t=0;t<h.length;t++){const r=h[t].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(d)}}function m(d){switch(d){case"onPointerLeave":case"onPointerCancel":return()=>p([]);case"onLostPointerCapture":return h=>{const{internal:t}=e.getState();"pointerId"in h&&t.capturedMap.has(h.pointerId)&&requestAnimationFrame(()=>{t.capturedMap.has(h.pointerId)&&(t.capturedMap.delete(h.pointerId),p([]))})}}return function(t){const{onPointerMissed:r,internal:c}=e.getState();c.lastEvent.current=t;const l=d==="onPointerMove",u=d==="onClick"||d==="onContextMenu"||d==="onDoubleClick",v=o(t,l?i:void 0),s=u?n(t):0;d==="onPointerDown"&&(c.initialClick=[t.offsetX,t.offsetY],c.initialHits=v.map(g=>g.eventObject)),u&&!v.length&&s<=2&&(y(t,c.interaction),r&&r(t)),l&&p(v);function a(g){const C=g.eventObject,S=C.__r3f,P=S==null?void 0:S.handlers;if(S!=null&&S.eventCount)if(l){if(P.onPointerOver||P.onPointerEnter||P.onPointerOut||P.onPointerLeave){const j=te(g),D=c.hovered.get(j);D?D.stopped&&g.stopPropagation():(c.hovered.set(j,g),P.onPointerOver==null||P.onPointerOver(g),P.onPointerEnter==null||P.onPointerEnter(g))}P.onPointerMove==null||P.onPointerMove(g)}else{const j=P[d];j?(!u||c.initialHits.includes(C))&&(y(t,c.interaction.filter(D=>!c.initialHits.includes(D))),j(g)):u&&c.initialHits.includes(C)&&y(t,c.interaction.filter(D=>!c.initialHits.includes(D)))}}f(v,t,s,a)}}return{handlePointer:m}}const Ie=e=>!!(e!=null&&e.render),Be=b.createContext(null),St=(e,n)=>{const i=Ue((m,d)=>{const h=new re,t=new re,r=new re;function c(s=d().camera,a=t,g=d().size){const{width:C,height:S,top:P,left:j}=g,D=C/S;a.isVector3?r.copy(a):r.set(...a);const O=s.getWorldPosition(h).distanceTo(r);if(Te(s))return{width:C/s.zoom,height:S/s.zoom,top:P,left:j,factor:1,distance:O,aspect:D};{const x=s.fov*Math.PI/180,w=2*Math.tan(x/2)*O,M=w*(C/S);return{width:M,height:w,top:P,left:j,factor:C/M,distance:O,aspect:D}}}let l;const u=s=>m(a=>({performance:{...a.performance,current:s}})),_=new ot;return{set:m,get:d,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(d(),s),advance:(s,a)=>n(s,a,d()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new it,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=d();l&&clearTimeout(l),s.performance.current!==s.performance.min&&u(s.performance.min),l=setTimeout(()=>u(d().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:s=>m(a=>({...a,events:{...a.events,...s}})),setSize:(s,a,g,C,S)=>{const P=d().camera,j={width:s,height:a,top:C||0,left:S||0,updateStyle:g};m(D=>({size:j,viewport:{...D.viewport,...c(P,t,j)}}))},setDpr:s=>m(a=>{const g=Ae(s);return{viewport:{...a.viewport,dpr:g,initialDpr:a.viewport.initialDpr||g}}}),setFrameloop:(s="always")=>{const a=d().clock;a.stop(),a.elapsedTime=0,s!=="never"&&(a.start(),a.elapsedTime=0),m(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:b.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,a,g)=>{const C=d().internal;return C.priority=C.priority+(a>0?1:0),C.subscribers.push({ref:s,priority:a,store:g}),C.subscribers=C.subscribers.sort((S,P)=>S.priority-P.priority),()=>{const S=d().internal;S!=null&&S.subscribers&&(S.priority=S.priority-(a>0?1:0),S.subscribers=S.subscribers.filter(P=>P.ref!==s))}}}}}),o=i.getState();let f=o.size,p=o.viewport.dpr,y=o.camera;return i.subscribe(()=>{const{camera:m,size:d,viewport:h,gl:t,set:r}=i.getState();if(d.width!==f.width||d.height!==f.height||h.dpr!==p){var c;f=d,p=h.dpr,bt(m,d),t.setPixelRatio(h.dpr);const l=(c=d.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&t.domElement instanceof HTMLCanvasElement;t.setSize(d.width,d.height,l)}m!==y&&(y=m,r(l=>({viewport:{...l.viewport,...l.viewport.getCurrentViewport(m)}})))}),i.subscribe(m=>e(m)),i};let ne,Pt=new Set,Mt=new Set,xt=new Set;function fe(e,n){if(e.size)for(const{callback:i}of e.values())i(n)}function Q(e,n){switch(e){case"before":return fe(Pt,n);case"after":return fe(Mt,n);case"tail":return fe(xt,n)}}let de,pe;function ve(e,n,i){let o=n.clock.getDelta();for(n.frameloop==="never"&&typeof e=="number"&&(o=e-n.clock.elapsedTime,n.clock.oldTime=n.clock.elapsedTime,n.clock.elapsedTime=e),de=n.internal.subscribers,ne=0;ne<de.length;ne++)pe=de[ne],pe.ref.current(pe.store.getState(),o,i);return!n.internal.priority&&n.gl.render&&n.gl.render(n.scene,n.camera),n.internal.frames=Math.max(0,n.internal.frames-1),n.frameloop==="always"?1:n.internal.frames}function Rt(e){let n=!1,i=!1,o,f,p;function y(h){f=requestAnimationFrame(y),n=!0,o=0,Q("before",h),i=!0;for(const r of e.values()){var t;p=r.store.getState(),p.internal.active&&(p.frameloop==="always"||p.internal.frames>0)&&!((t=p.gl.xr)!=null&&t.isPresenting)&&(o+=ve(h,p))}if(i=!1,Q("after",h),o===0)return Q("tail",h),n=!1,cancelAnimationFrame(f)}function m(h,t=1){var r;if(!h)return e.forEach(c=>m(c.store.getState(),t));(r=h.gl.xr)!=null&&r.isPresenting||!h.internal.active||h.frameloop==="never"||(t>1?h.internal.frames=Math.min(60,h.internal.frames+t):i?h.internal.frames=2:h.internal.frames=1,n||(n=!0,requestAnimationFrame(y)))}function d(h,t=!0,r,c){if(t&&Q("before",h),r)ve(h,r,c);else for(const l of e.values())ve(h,l.store.getState());t&&Q("after",h)}return{loop:y,invalidate:m,advance:d}}function He(){const e=b.useContext(Be);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function H(e=i=>i,n){return He()(e,n)}function jt(e,n=0){const i=He(),o=i.getState().internal.subscribe,f=Le(e);return ee(()=>o(f,n,i),[n,o,i]),null}const Z=new Map,{invalidate:xe,advance:Re}=Rt(Z),{reconciler:ie,applyProps:W}=ht(Z,_t),X={objects:"shallow",strict:!1},Ot=(e,n)=>{const i=typeof e=="function"?e(n):e;return Ie(i)?i:new nt({powerPreference:"high-performance",canvas:n,antialias:!0,alpha:!0,...e})};function Tt(e,n){const i=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(n){const{width:o,height:f,top:p,left:y,updateStyle:m=i}=n;return{width:o,height:f,top:p,left:y,updateStyle:m}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:o,height:f,top:p,left:y}=e.parentElement.getBoundingClientRect();return{width:o,height:f,top:p,left:y,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function Lt(e){const n=Z.get(e),i=n==null?void 0:n.fiber,o=n==null?void 0:n.store;n&&console.warn("R3F.createRoot should only be called once!");const f=typeof reportError=="function"?reportError:console.error,p=o||St(xe,Re),y=i||ie.createContainer(p,K.ConcurrentRoot,null,!1,null,"",f,null);n||Z.set(e,{fiber:y,store:p});let m,d=!1,h;return{configure(t={}){let{gl:r,size:c,scene:l,events:u,onCreated:_,shadows:v=!1,linear:s=!1,flat:a=!1,legacy:g=!1,orthographic:C=!1,frameloop:S="always",dpr:P=[1,2],performance:j,raycaster:D,camera:O,onPointerMissed:x}=t,w=p.getState(),M=w.gl;w.gl||w.set({gl:M=Ot(r,e)});let A=w.raycaster;A||w.set({raycaster:A=new Xe});const{params:q,...T}=D||{};if(R.equ(T,A,X)||W(A,{...T}),R.equ(q,A.params,X)||W(A,{params:{...A.params,...q}}),!w.camera||w.camera===h&&!R.equ(h,O,X)){h=O;const L=O instanceof rt,E=L?O:C?new $e(0,0,0,0,.1,1e3):new Ye(75,0,.1,1e3);L||(E.position.z=5,O&&(W(E,O),("aspect"in O||"left"in O||"right"in O||"bottom"in O||"top"in O)&&(E.manual=!0,E.updateProjectionMatrix())),!w.camera&&!(O!=null&&O.rotation)&&E.lookAt(0,0,0)),w.set({camera:E}),A.camera=E}if(!w.scene){let L;l!=null&&l.isScene?L=l:(L=new Ke,l&&W(L,l)),w.set({scene:$(L)})}if(!w.xr){var U;const L=(k,V)=>{const B=p.getState();B.frameloop!=="never"&&Re(k,!0,B,V)},E=()=>{const k=p.getState();k.gl.xr.enabled=k.gl.xr.isPresenting,k.gl.xr.setAnimationLoop(k.gl.xr.isPresenting?L:null),k.gl.xr.isPresenting||xe(k)},I={connect(){const k=p.getState().gl;k.xr.addEventListener("sessionstart",E),k.xr.addEventListener("sessionend",E)},disconnect(){const k=p.getState().gl;k.xr.removeEventListener("sessionstart",E),k.xr.removeEventListener("sessionend",E)}};typeof((U=M.xr)==null?void 0:U.addEventListener)=="function"&&I.connect(),w.set({xr:I})}if(M.shadowMap){const L=M.shadowMap.enabled,E=M.shadowMap.type;if(M.shadowMap.enabled=!!v,R.boo(v))M.shadowMap.type=se;else if(R.str(v)){var G;const I={basic:Qe,percentage:Je,soft:se,variance:Ze};M.shadowMap.type=(G=I[v])!=null?G:se}else R.obj(v)&&Object.assign(M.shadowMap,v);(L!==M.shadowMap.enabled||E!==M.shadowMap.type)&&(M.shadowMap.needsUpdate=!0)}const F=Oe();F&&("enabled"in F?F.enabled=!g:"legacyMode"in F&&(F.legacyMode=g)),d||W(M,{outputEncoding:s?3e3:3001,toneMapping:a?et:tt}),w.legacy!==g&&w.set(()=>({legacy:g})),w.linear!==s&&w.set(()=>({linear:s})),w.flat!==a&&w.set(()=>({flat:a})),r&&!R.fun(r)&&!Ie(r)&&!R.equ(r,M,X)&&W(M,r),u&&!w.events.handlers&&w.set({events:u(p)});const z=Tt(e,c);return R.equ(z,w.size,X)||w.setSize(z.width,z.height,z.updateStyle,z.top,z.left),P&&w.viewport.dpr!==Ae(P)&&w.setDpr(P),w.frameloop!==S&&w.setFrameloop(S),w.onPointerMissed||w.set({onPointerMissed:x}),j&&!R.equ(j,w.performance,X)&&w.set(L=>({performance:{...L.performance,...j}})),m=_,d=!0,this},render(t){return d||this.configure(),ie.updateContainer(N.jsx(kt,{store:p,children:t,onCreated:m,rootElement:e}),y,null,()=>{}),p},unmount(){Ne(e)}}}function kt({store:e,children:n,onCreated:i,rootElement:o}){return ee(()=>{const f=e.getState();f.set(p=>({internal:{...p.internal,active:!0}})),i&&i(f),e.getState().events.connected||f.events.connect==null||f.events.connect(o)},[]),N.jsx(Be.Provider,{value:e,children:n})}function Ne(e,n){const i=Z.get(e),o=i==null?void 0:i.fiber;if(o){const f=i==null?void 0:i.store.getState();f&&(f.internal.active=!1),ie.updateContainer(null,o,null,()=>{f&&setTimeout(()=>{try{var p,y,m,d;f.events.disconnect==null||f.events.disconnect(),(p=f.gl)==null||(y=p.renderLists)==null||y.dispose==null||y.dispose(),(m=f.gl)==null||m.forceContextLoss==null||m.forceContextLoss(),(d=f.gl)!=null&&d.xr&&f.xr.disconnect(),wt(f),Z.delete(e)}catch{}},500)})}}ie.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:b.version});const he={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Dt(e){const{handlePointer:n}=Ct(e);return{priority:1,enabled:!0,compute(i,o,f){o.pointer.set(i.offsetX/o.size.width*2-1,-(i.offsetY/o.size.height)*2+1),o.raycaster.setFromCamera(o.pointer,o.camera)},connected:void 0,handlers:Object.keys(he).reduce((i,o)=>({...i,[o]:n(o)}),{}),update:()=>{var i;const{events:o,internal:f}=e.getState();(i=f.lastEvent)!=null&&i.current&&o.handlers&&o.handlers.onPointerMove(f.lastEvent.current)},connect:i=>{var o;const{set:f,events:p}=e.getState();p.disconnect==null||p.disconnect(),f(y=>({events:{...y.events,connected:i}})),Object.entries((o=p.handlers)!=null?o:[]).forEach(([y,m])=>{const[d,h]=he[y];i.addEventListener(d,m,{passive:h})})},disconnect:()=>{const{set:i,events:o}=e.getState();if(o.connected){var f;Object.entries((f=o.handlers)!=null?f:[]).forEach(([p,y])=>{if(o&&o.connected instanceof HTMLElement){const[m]=he[p];o.connected.removeEventListener(m,y)}}),i(p=>({events:{...p.events,connected:void 0}}))}}}}const At=b.forwardRef(function({children:n,fallback:i,resize:o,style:f,gl:p,events:y=Dt,eventSource:m,eventPrefix:d,shadows:h,linear:t,flat:r,legacy:c,orthographic:l,frameloop:u,dpr:_,performance:v,raycaster:s,camera:a,scene:g,onPointerMissed:C,onCreated:S,...P},j){b.useMemo(()=>vt(ct),[]);const D=Ve(),[O,x]=We({scroll:!0,debounce:{scroll:50,resize:0},...o}),w=b.useRef(null),M=b.useRef(null);b.useImperativeHandle(j,()=>w.current);const A=Le(C),[q,T]=b.useState(!1),[U,G]=b.useState(!1);if(q)throw q;if(U)throw U;const F=b.useRef(null);ee(()=>{const L=w.current;x.width>0&&x.height>0&&L&&(F.current||(F.current=Lt(L)),F.current.configure({gl:p,events:y,shadows:h,linear:t,flat:r,legacy:c,orthographic:l,frameloop:u,dpr:_,performance:v,raycaster:s,camera:a,scene:g,size:x,onPointerMissed:(...E)=>A.current==null?void 0:A.current(...E),onCreated:E=>{E.events.connect==null||E.events.connect(m?mt(m)?m.current:m:M.current),d&&E.setEvents({compute:(I,k)=>{const V=I[d+"X"],B=I[d+"Y"];k.pointer.set(V/k.size.width*2-1,-(B/k.size.height)*2+1),k.raycaster.setFromCamera(k.pointer,k.camera)}}),S==null||S(E)}}),F.current.render(N.jsx(D,{children:N.jsx(ke,{set:G,children:N.jsx(b.Suspense,{fallback:N.jsx(gt,{set:T}),children:n??null})})})))}),b.useEffect(()=>{const L=w.current;if(L)return()=>Ne(L)},[]);const z=m?"none":"auto";return N.jsx("div",{ref:M,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:z,...f},...P,children:N.jsx("div",{ref:O,style:{width:"100%",height:"100%"},children:N.jsx("canvas",{ref:w,style:{display:"block"},children:i})})})}),Nt=b.forwardRef(function(n,i){return N.jsx(Ge,{children:N.jsx(At,{...n,ref:i})})});function Ft(e,n,i){const o=H(c=>c.size),f=H(c=>c.viewport),p=typeof e=="number"?e:o.width*f.dpr,y=o.height*f.dpr,m=(typeof e=="number"?i:e)||{},{samples:d=0,depth:h,...t}=m,r=b.useMemo(()=>{const c=new lt(p,y,{minFilter:we,magFilter:we,type:ut,...t});return h&&(c.depthTexture=new ft(p,y,dt)),c.samples=d,c},[]);return b.useLayoutEffect(()=>{r.setSize(p,y),d&&(r.samples=d)},[d,r,p,y]),b.useEffect(()=>()=>r.dispose(),[]),r}const zt=e=>typeof e=="function",Ut=b.forwardRef(({envMap:e,resolution:n=256,frames:i=1/0,makeDefault:o,children:f,...p},y)=>{const m=H(({set:v})=>v),d=H(({camera:v})=>v),h=H(({size:v})=>v),t=b.useRef(null);b.useImperativeHandle(y,()=>t.current,[]);const r=b.useRef(null),c=Ft(n);b.useLayoutEffect(()=>{p.manual||(t.current.aspect=h.width/h.height)},[h,p]),b.useLayoutEffect(()=>{t.current.updateProjectionMatrix()});let l=0,u=null;const _=zt(f);return jt(v=>{_&&(i===1/0||l<i)&&(r.current.visible=!1,v.gl.setRenderTarget(c),u=v.scene.background,e&&(v.scene.background=e),v.gl.render(v.scene,t.current),v.scene.background=u,v.gl.setRenderTarget(null),r.current.visible=!0,l++)}),b.useLayoutEffect(()=>{if(o){const v=d;return m(()=>({camera:t.current})),()=>m(()=>({camera:v}))}},[t,o,m]),b.createElement(b.Fragment,null,b.createElement("perspectiveCamera",je({ref:t},p),!_&&f),b.createElement("group",{ref:r},_&&f(c.texture)))}),qt=b.forwardRef(({children:e,domElement:n,onChange:i,onMouseDown:o,onMouseUp:f,onObjectChange:p,object:y,makeDefault:m,camera:d,enabled:h,axis:t,mode:r,translationSnap:c,rotationSnap:l,scaleSnap:u,space:_,size:v,showX:s,showY:a,showZ:g,...C},S)=>{const P=H(E=>E.controls),j=H(E=>E.gl),D=H(E=>E.events),O=H(E=>E.camera),x=H(E=>E.invalidate),w=H(E=>E.get),M=H(E=>E.set),A=d||O,q=n||D.connected||j.domElement,T=b.useMemo(()=>new pt(A,q),[A,q]),U=b.useRef(null);b.useLayoutEffect(()=>(y?T.attach(y instanceof be?y:y.current):U.current instanceof be&&T.attach(U.current),()=>void T.detach()),[y,e,T]),b.useEffect(()=>{if(P){const E=I=>P.enabled=!I.value;return T.addEventListener("dragging-changed",E),()=>T.removeEventListener("dragging-changed",E)}},[T,P]);const G=b.useRef(),F=b.useRef(),z=b.useRef(),L=b.useRef();return b.useLayoutEffect(()=>void(G.current=i),[i]),b.useLayoutEffect(()=>void(F.current=o),[o]),b.useLayoutEffect(()=>void(z.current=f),[f]),b.useLayoutEffect(()=>void(L.current=p),[p]),b.useEffect(()=>{const E=B=>{x(),G.current==null||G.current(B)},I=B=>F.current==null?void 0:F.current(B),k=B=>z.current==null?void 0:z.current(B),V=B=>L.current==null?void 0:L.current(B);return T.addEventListener("change",E),T.addEventListener("mouseDown",I),T.addEventListener("mouseUp",k),T.addEventListener("objectChange",V),()=>{T.removeEventListener("change",E),T.removeEventListener("mouseDown",I),T.removeEventListener("mouseUp",k),T.removeEventListener("objectChange",V)}},[x,T]),b.useEffect(()=>{if(m){const E=w().controls;return M({controls:T}),()=>M({controls:E})}},[m,T]),b.createElement(b.Fragment,null,b.createElement("primitive",{ref:S,object:T,enabled:h,axis:t,mode:r,translationSnap:c,rotationSnap:l,scaleSnap:u,space:_,size:v,showX:s,showY:a,showZ:g}),b.createElement("group",je({ref:U},C),e))});export{Nt as C,Ut as P,qt as T,H as u};
